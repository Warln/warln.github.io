<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0;">
<title>基于视觉的铁路监测系统中的自动紧固件分类与缺陷检测</title>
<style>
	body{
		margin: 0 7em;
	}
	h1,h2{
		text-align: center;
	}
	a{
		outline: none;
		color: #4a4266;
	}
	p,ol>li>div{
		text-indent: 2em;
	}
	i{
		padding: 0 .3em;
	}
	ol{
		counter-reset: list;
		list-style: none;
	}
	li:before{
		counter-increment: list;
		content: counter(list)"）";
	}
	-table{
		border: 1px solid;
		frame: border;
		rules: all;
	}
</style>
<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
	window.onload = function(){
		var figs = [
			'http://r6.loli.io/z2Evua.gif',
			'http://r5.loli.io/imYVvy.gif',
			'http://r5.loli.io/NvemQz.gif',
			'http://r5.loli.io/fyquA3.gif',
			'http://r6.loli.io/IrA7Nj.gif',
			'http://r6.loli.io/R7rEby.gif',
			'http://r6.loli.io/IraqIr.gif',
			'http://r6.loli.io/zmyUvm.gif',
			'http://r5.loli.io/NfIZZj.gif',
			'http://r6.loli.io/3MJJby.gif',
			'http://r6.loli.io/Er6BNn.gif',
			'http://r6.loli.io/AVRz6f.gif',
			'http://r6.loli.io/EvmIz2.gif',
			'http://r6.loli.io/fYrmEz.gif',
			'http://r6.loli.io/iY3aE3.gif',
			'http://r5.loli.io/QZbYja.gif',
			'http://r.loli.io/MfYVfe.gif',
			'http://r.loli.io/7BZFJn.gif'
		];
		var figcap = [
			'车载摄像机拍摄的图像',
			'损坏和缺失的紧固件，(a)左边的紧固件是部分损坏了的，(b)右边紧固件完全缺失',
			'三种类型的紧固件。(a)类型-I 左，(b)类型-I 右，(c)类型-II 左，(d)类型-II 右，(e)类型-III 左，(f)类型-III 右',
			'(a)-(e)紧固件光照条件不同，(f)紧固件被泄露的润滑脂污染了',
			'我们的紧固件检测系统的构造',
			'数据处理模块流程图',
			'LDA图形模型表示',
			'STM图形模型表示',
			'其他STM设置图形模型表示(只显示变更的部分)，单一特征(a)和多个特征(b)的STM模型',
			'Haar-Like特征',
			'考虑到的紧固件的素描',
			'轨道和轨枕检测结果，(a)原始图像，(b)检测结果',
			'一些训练样本的话题分配结果，在此我们选择了11个话题，每个话题显示了4个样本，每个话题都提供了标签，L：左边的紧固件，R：右边的紧固件',
			'每个测试图像的规范化概率映射，概率映射被规范化为0-255，较明亮的像素概率较高，从左到右为原始测试图像和话题0-6的概率映射，空间有限，只展示了前6个映射',
			'误分类样本的示例，(a)部分损坏的紧固件，(b)缺失的紧固件',
			'分级结果示例',
			'光照变化的紧固件分类和分级的结果',
			'并行计算的系统构成'
		];
		var a = document.querySelectorAll('a');
		document.body.onclick = function(evt){
			var evt = evt || window.event;
			var tgt = evt.target || evt.srcElement;
			if(tgt.nodeName.toLowerCase() === 'a' && tgt.name === 'fig'){
				var no = +tgt.innerText.replace('Fig．', '');
				var fig = '<figure>'
  				+ '<img src="' + figs[no - 1] + '"/>'
  				+ '<figcaption>'
					+ '<b>Fig．' + no + '</b>'
					+ figcap[no - 1]
					+ '</figcaption>'
					+'</figure>';
				
			}
		};
		
		/*
		var img = document.querySelectorAll('img');
		var imglen = img.length;
		for(var i = 0; i < len; i++){
			img[i].width /= 2;
			img[i].height /= 1.5;
		}
		*/
		/*
		var alen = a.length;
		for(var i = 0; i < alen; i++){
			var figno = parseInt(a[i].innerText);
			var fig = '<figure>'
  			+ '<figcaption>'
				+ '<b>Fig．' + i + '</b>'
				+ figcap[i]
				+ '</figcaption>'
  			+ '<img src="' + figs[i] + '"/>'
				+'</figure>';
			a[i].onclick = function(){
				layer.open({
					type: 4,
					content: fig
				});
				alert(parseInt(this.innerText));
			};
		}
		*/
	};
</script>
</head>
<body>
	<h1>基于视觉的铁路监测系统中的自动紧固件分类与缺陷检测</h1>
	<p>Hao Feng，Zhiguo Jiang，Fengying Xie，Ping Yang，Jun Shi，Long Chen</p>
	<p>摘要——在铁路检测系统中，检测紧固件缺陷是一个重要任务，是保证列车运输安全的常用手段。传统检测通常是由铁路工人沿着铁路行走来搜寻潜在的风险。然而，人工检测非常缓慢，耗费和危险。这篇文章提供了一个建议，利用自动化视觉检测系统来检测部分磨损和完全遗失的紧固件，使用的是概率主题模型的方法。特别的，我们的方法使用了无标记数据，能同时适用于不同方向和光照条件的各种紧固件。为了评估损坏程度，测试的紧固件被与已训练过的模型做比较，并且基于似然概率自动分为三个等级。实验结果展示了该方法的有效性。</p>
	<p>索引条目——紧固件，隐狄利克雷分布（LDA），铁路，结构建模，视觉检测</p>
	<h2>I．介绍</h2>
	<p>铁路检测对于保证列车运输安全来说是个极具风险的任务。传统情况下，这项任务是由人工检测员定期沿铁路线行走来搜查铁路组件的各种损伤，然而人工检测不仅缓慢，耗费大，甚至还很危险。随着高速铁路网的延伸，检测和维护工作就面临比以往更多的挑战。近期以来，世界各地的铁路公司都着眼于自动检测系统，这种系统经由一系列训练后能够对铁路缺陷进行有效检测［1］。</p>
	<p>自动化铁路检测系统由若干功能组成，如尺形测量［2］，轨道纵断面测量［1］，［3］，轨面缺陷检测［4］，及紧固件缺陷检测［5］［6］。我们的研究目标主要是基于计算机视觉技术的自动检索及评估部分损坏和遗失的紧固件。</p>
	<p>紧固件是用来将轨道和轨枕抓扣在一起的，如图<a href="javascript:;" name="fig">Fig．1</a>所示，而图<a href="javascript:;" name="fig">Fig．2</a>展示的损坏和缺失的紧固件是会造成轨道位移甚至威胁列车操作安全的事故性缺陷。一般情况下会有两种紧固件，1）六角螺栓形，2）钩形。钩形紧固件广泛用于当前的铁路线上，然而其多样的形状给建模和检测带来了不少困难。这篇文章中，多种类型的钩形紧固件和六角螺栓都会被考虑到。</p>
	<p>过去的十年里，一些研究者致力于开发紧固件检测方法。对于六角螺栓，Mario <i>et al.</i> ［7］用了一个多层感知神经分类器来检测螺栓。对于钩形紧固件，Stella <i>et al.</i> ［8］利用了小波变换和主成分分析来预处理铁路图像，并使用神经分类器来搜寻缺失紧固件。相似地，Yang <i>et al.</i> ［9］利用方向场作为紧固件的模板，而匹配时，他们使用线性判别分析来获得权重系数矩阵。为了实现实时效果，Ruvo <i>et al.</i> ［10］应用误差反向传播算法来对两类紧固件进行建模，他们在图像处理器上执行了检测算法。Ruvo <i>et al.</i> ［11］也介绍了一个基于FPGA的相同算法的结构，可用于自动六角螺栓检测。然而以上提到的这些方无法识别部分损坏的紧固件，近期Xia <i>et la.</i> ［5］和Rubinsztejn［12］成功将AdaBoost算法应用到了紧固件检测工作。特别要说的是，Xia <i>et la.</i> ［6］把钩形紧固件分成4部分，每部分独立地由AdaBoost训练，因此，这个方法能够检测部分损坏的紧固件。与此相似，Li <i>et la.</i> ［13］使用图像处理方法来检测紧固件的组件。但是，这两种方法只能处理特殊的紧固件类型，而对于复杂光照下的鲁棒性没有讨论。其他已被用于建模和检测紧固件的技术还有支持向量机（SVM）［14］，Gabor滤波器［15］，以及边缘检测［16］。总的来说，大多数早期的方法采用判别模型（分类器）来对紧固件和非紧固件采样进行分类，但是这些方法很难识别部分损坏的紧固件，因为这些损坏没有统一的表示方法。尽管一定程度上基于部分的方法［5］，［13］能解决该问题，但是却需要多个分类器而且只能处理特殊型的紧固件。另一方面，要训练分类器，若干标签化的紧固件样本，包括缺损的和完整都要采集到。然而，部分损坏的紧固件数量非常有限，我们的方法就是设计来检测这些不同种类的紧固件的缺陷，而且能找出部分损坏的以及完全缺失的紧固件。不同于早期依赖判别模型方法，我们使用生成模型解决了这个问题。因此，训练阶段只需要完好的紧固件样本，同时我们的训练集合是无标签的，由不同的紧固件类型、方向和光照条件构成。</p>
	<p>我们总结了当前紧固件检测系统中的三个主要问题。</p>
	<p>
		<ol>
			<li>有大量部分损坏的紧固件已经失去作用，然而多数研究针对的是搜寻缺失的紧固件，而通常无法识别部分损坏的紧固件。</li>
			<li>由于各种原因（例如图<a href="javascript:;" name="fig">Fig．3</a>所示），一条铁路线上总是安装有不同类型的紧固件，因此，无需人工干预就能识别所有类型的自动检测系统就很有必要了。</li>
			<li>抓获的图像的质量其光照条件不统一。通常相机是被安装在客车底部的一个开放区域，阳光完全能影响到获取到的图像的亮度，如图<a href="javascript:;" name="fig">Fig．4</a>所示。虽然使用了主动光源和遮光板，问题还是没有解决。另一方面，紧固件常被石头、泄露的润滑脂和垃圾盖住，这些问题影响了一些紧固件检测算法的表现。</li>
		</ol>
	</p>
	<p>要处理这些问题，我们使用了一个新的概率结构主题模型（STM）来建模紧固件，模型是生成的，数据驱动的，且使用非标签采样，同时能学会不同对象的概率表示。我们使用一组完整紧固件样本来训练紧固件模型，与基于分类器的实现相比较，STM只关心紧固件的内在特征。似然概率可用于测量测试紧固件和模型间的相似度，一般地，损坏的紧固件比完好的紧固件有更低的似然概率。我们把紧固件基于其似然概率分为三个级别，级别从高到低排列。完好的紧固件被分到高级，部分损坏的或污染的被分到中级，严重损坏和缺失的被分到低级。</p>
	<p>STM是隐狄利克雷分布（LDA）［17］的一个延伸，隐狄利克雷分布是一个对来自语言词语的语义主题和其他离散数据进行非监督提取和建模的概率主题模型。计算机视觉领域的很多建模问题已经被使用LDA模型解决了［18］-［20］。为了最大化利用现有知识，首要研究的是让LDA具有结构分析的能力。STM有和LDA同样的优点，它能够根据相似结构把样本集群到一个类别，且同时生成该类的概率模型。</p>
	<p>总的说来，我们的方法有以下三个优点。</p>
	<p>
		<ol>
			<li>可以识别多种类型的紧固件，每个方向的所有类型紧固件都能同时从非标签样本学会。</li>
			<li>不同光照条件的紧固件独立建模，因而光照变化不会影响最终表现。</li>
			<li>我们的系统自动输出紧固件的状态，该设计为人工检测员评估缺损提供了便利，特别的，该方法能够有效检测部分损坏的紧固件。</li>
		</ol>
	</p>
	<p>这篇文章将这样组织，第二部分为系统概述，第三部分简要介绍紧固件定位算法，第四部分介绍STM模型，第五部分实验结果说明，第六部分文章总结。</p>
	<h2>II．系统概述</h2>
	<p>系统配置如图<a href="javascript:;" name="fig">Fig．5</a>，客车下方挂有两台相机，每台负责检测一边的轨道。所获图像的大小为560×900像素，采集的图像如<a href="javascript:;" name="fig">Fig．1</a>中所示。图像被发送并输入到机载高性能计算机的数据处理模块，数据处理模块有三个主要组成部分：1）紧固件定位；2）紧固件分类；3）结果分级。最终结果呈现在一个可交互用户界面上，以便于将来的人工检测和分析。数据处理模块的流程如图<a href="javascript:;" name="fig">Fig．6</a>所示。</p>
	<p>概述的几部分主要内容如下。</p>
	<p>
		<ol>
			<li><i>紧固件定位：</i>紧固件是永久安装在两边轨道的每个轨枕上的，所以定位紧固件可替为检测轨枕和轨道。检测可通过搜寻某些线段间的几何关系来实现，为了减轻计算负担，我们根据两根相邻轨枕间的恒定距离来预测出紧固件的位置。</li>
			<li><i>紧固件分类：</i>然后出现紧固件的图像区域被发送到分类模块，在此，依据学习模型，每个测试紧固件的类型都被确定下来。</li>
			<li><i>磨损分级：</i>我们测量某个紧固件和相应模型的一致性，然后根据似然概率把紧固件分为三个等级。被分到低等级的紧固件为严重损坏或缺失的，必须立即更换。大多数紧固件被分到中级，主要是部分损坏了的，这些紧固件还需要人工进行深入评估。</li>
		</ol>
	</p>
	<p>这里要说的是，本文对数据处理模块的软件算法开发的篇幅有限，不会详细谈及图像采集子系统。</p>
	<h2>III．紧固件定位</h2>
	<p>紧固件的位置可通过轨枕和轨道的位置间接确定。本文中，我将会用鲁棒线段检测算法，以及几个关系来定位轨枕和轨道。我们首先介绍轨道检测和轨枕检测算法，然后讲解一个轨枕预测方法，该方法可以提高检测速度和增强鲁棒性。</p>
	<h3><i>A．轨道检测</i></h3>
	<p>在一个采集的图像中，轨道看起来像图像中部附近的一个竖向的矩形。多数时，图像会由于轨道光滑的头面带来的高反射率而过曝。检测轨道可简化为检测两条最长的竖线，首先，线段检测器（LSD）［21］用来提取线条，靠近水平坐标中央的竖线会被保留，然后，像素值会被投影到x轴上以生成累计强度直方图，最终，竖线重叠的位置以及直方图中上升或下降明显的地方被视作轨道边缘。</p>
	<h3><i>B．轨枕检测</i></h3>
	<p>对于多数铁路基础设施，轨枕相对于轨道是对称的，并且等距分布在铁路线上。因此，通过在同一个y轴坐标上简单的搜寻对称线对就能检测出轨枕。算法由以下三步构成。</p>
	<p>
		<ol>
			<li>LSD算法从图像上提取线段，只保留水平方向上的。</li>
			<li>这些线条中，识别出平行的线，两条平行线之间的距离不长于一根轨枕的宽度，对这里的图像来说，一根轨枕的最大宽度是180像素。</li>
			<li>对于每组平行线，如果在另一边的轨道有一条或多条相应的平行线有相同的纵坐标，则这些平行线包围的区域就识别为轨枕。</li>
		</ol>
	</p>
	<h3><i>C．轨枕预测</i></h3>
	<p>紧固件的位置可根据先前检测到的轨枕的位置简单添加<i>Dy</i>来预测。如图<a href="javascript:;" name="fig">Fig．1</a>所示，<i>Dy</i>是两根相邻轨枕间的恒定距离。我们这里的实现中，<i>Dy</i>通过对前100帧执行轨枕定位算法来初始化，然后后面的的轨枕的位置由未来帧预测出。轨枕检测算法也会每500帧执行来修正<i>Dy</i>，并防止累积误差。再以后，当分类阶段所有相邻紧固件得到极低的似然概率时，再次计算<i>Dy</i>。</p>
	<h2>IV．紧固件分类</h2>
	<p>为了有效的对紧固件建模，我们使用了一种结构分析方法，利用的是LDA模型。我们把我们的模型叫做STM。这部分的前面两块内容，首先对LDA做一个简短介绍，并详细说说我们的STM模型。特征计算和其他实现的细节会分别地在IV-C部分和IV-D部分中介绍。</p>
	<h3><i>A.隐狄利克雷分布</i></h3>
	<p>有两种方式理解LDA［17］：1）LDA是一个概率集群方法，能基于共生性将单词集群进语义化主题，2）LDA是一个数据驱动模型，并且能自动从未标记离散数据中挖掘隐含主题。另一方面，LDA也有些不足，最明显的一点是单词间的空间关系被忽略了。要清楚地理解LDA主题模型，首先来看<a href="javascript:;" name="fig">Fig．7</a>中的概率图形模型表示。</p>
	<p>给出一个<i>M</i>文档的集合，由\(I_m=\{I_1,I_2,\dots,I_M\}\)表示，每个文档有<i>N</i>个单词。LDA把单词\(\omega_n,n=\{1,2,\dots,N\}\)分组到<i>K</i>个主题中，相当于给每个单词赋予一个隐含主题。在图<a href="javascript:;" name="fig">Fig．7</a>中，\(z_n\)是一个索引，指示单词\(\omega_n\)的主题标签，\(\theta_i\)表示的是一个文档的主题分布（document-topic distribution）且其自身有一个参数为\(\alpha\)的狄利克雷先验，\(\beta\)是每个隐含主题的单词分布矩阵（topic-word distribution）。</p>
	<p>要把模型用来解决计算机视觉问题，图像概念必须转换为对应的语言概念。存在两个方面：1）用特征袋［20］把图像特征转化为单词（通常叫做视觉单词），这个问题将在IV-D部分来说；2）在STM中，主题被转换为紧固件种类。此模型的描述在IV-B部分中。</p>
	<h3><i>B．用STM建模紧固件</i></h3>
	<p>考虑视觉单词空间信息的STM是生成主题模型的一个扩展。我们在主题层级构建紧固件的结构模型，在处理我们的紧固件建模问题时，STM模型有这两个优势：1）能从未标记样本同时学会多种类型的紧固件，并为每个紧固件种类（主题）生成模型，2）已学会的模型可以用来对紧固件分类，而且可以给损坏评估提供一致性分值。</p>
	<p>STM的图形化模型表示如图<a href="javascript:;" name="fig">Fig．8</a>所示。假设数据集包含<i>M</i>张铁路图像，表示为\(\theta_m=\{\theta_1,\dots,\theta_M\}\)，每个图像包含<i>N</i>个紧固件，\(z_n=\{1,\dots,K\}\)为一个紧固件的类标签。实际上，\(\theta_m\)表示第<i>m</i>个图像中紧固件种类的分布。一个紧固件种类表示为<i>P</i>个三元组\((W1_{nl},W2_{nl},E_{nl})\)的组成部分。特殊地，\(E_{nl}\)是一个到两个不同坐标的索引点，分别来自于视觉单词\(W1_{nl}\)和\(W2_{nl}\)的坐标，表示为\(C^{(1)}_{E_{nl}}\)和\(C^{(2)}_{E_{nl}}\)。在其他单词中triple是这样的，对每一种类型的紧固件来说，必须同时有两个指定的视觉单词出现在两个给定坐标。应当要说的是，通过简单的改变模型，\(E_{nl}\)能建议出仅仅一个或者多个坐标，如图<a href="javascript:;" name="fig">Fig．9</a>所示。在图<a href="javascript:;" name="fig">Fig．9</a>(a)中，\(E_{nl}\)只有一个坐标。在用相似的结构配置来建模对象时，这种简化导致了欠拟合。相反地，图<a href="javascript:;" name="fig">Fig．9</a>(b)中的模型在对象结构上施加了非常严格的约束，并导致表示变得过拟合。另外，在推演和参数估计过程，模型也会消耗大量内存和计算资源。</p>
	<p>从生成过程的角度来看，\(\theta_m\)是从带参数\(\alpha\)的狄利克雷分布采样的。对每个图像，紧固件分类\(z_n\)是从带参数\(\theta_m\)的多项分布得到的。对于一个紧固件分类，\(z_n\)一组坐标的索引来自于带参数\(y_{z_n}\)（class-coordinate distribution）的多项分布。假定\(C^{(1)}_{E_{nl}}\)和\(C^{(2)}_{E_{nl}}\)是\(E_{nl}\)的两个表示坐标，则视觉单词\(W1_{nl}\)和\(W2_{nl}\)分别从带参数\(\eta_{C^{(1)}_{E_{nl}}},Z_n\)和\(\delta_{C^{(2)}_{E_{nl}}},Z_n\)同时采样。\(\eta_{C^{(1)}_{E_{nl}}},Z_n\)和\(\delta_{C^{(2)}_{E_{nl}}},Z_n\)都服从关于紧固件分类和坐标的分布。生成过程总结为如下几步。</p>
	<p>
		<ol>
			<li>对于每个图像，根据Dirichlet(\(\alpha\))得出一个紧固件分类分布\(\theta_m\)。</li>
			<li>从多项式\(\theta_m\)得到一个紧固件分类\(z_n\)。</li>
			<li>对每一个紧固件样本，重复下面步骤<i>P</i>次。
				<div>a）根据Dirichlet(\(\alpha\))，得出一个类坐标分布\(\gamma\)。</div>
				<div>b）根据多项式(\(\gamma_{z_n}\))得出一个索引\(E_{nl}\)，相当于对两个坐标\(C^{(1)}_{E_{nl}}\)和\(C^{(2)}_{E_{nl}}\)采样。</div>
				<div>c）根据根据Dirichlet(\(\pi\))和根据Dirichlet(\(\rho\))分别得出分类单词分布\(\eta\)和\(\delta\)。</div>
				<div>d）分别根据多项式(\(C^{(1)}_{E_{nl}},z_n,\eta\))和(\(C^{(2)}_{E_{nl}},z_n,\delta\))得出视觉单词\(W1_{nl}\)和\(W2_{nl}\)。</div>
			</li>	
		</ol>
	</p>
	<p>给出超参数\(\alpha\)，\(\pi\)，\(\rho\)和\(\lambda\)，则隐藏变量\(\theta_m\)，\(z_n\)，\(\eta\)，\(\gamma_{z_n}\)和\(\rho\)以及观察到的三元组\((W1_{n},W2_{n},E_{n})\)的联合分布可写为：$$P(\theta,z,E,W1,W2|\alpha,\pi,\lambda,\rho)=P(\theta_m|\alpha)\prod^N_{n=1}\left[P(z_n|\theta_m)\sum^P_{l=1}P(E_{nl}|z_n,\lambda)P(W1_{nl}|E_{nl},z_n,\pi)P(W2_{nl}|E_{nl},z_n,\rho)\right]\quad(1)$$</p>
	<p>在STM中，准确的推断并不容易，但是可以用一个折叠Gibbs采样器来逼近分布［22］，［23］。Gibbs采样器在先前迭代［22］的所有数据和其他变量采样的条件下，跟随其分布对隐藏变量择一进行采样。在我们的应用中，我们只关心采样分类标签（话题）\(z\)。其他隐藏变量如\(\theta\)，\(\eta\)，\(\gamma\)和\(\delta\)能够在没有明确采样时被解析地边缘化。给出\(z\)的条件后验分布及所有观察结果由下式给出：$$p(z^d_i=j|z^d_{-i},\mathbf{w},\mathbf{e})\propto{\frac{n^{(d)}_{-i,j}+\alpha}{n^{(d)}_{-i,\cdot}+K\alpha}\sum^P_{l=1}\left(\frac{n^{E_{il}}_{-l,j}+\lambda}{n^{(\cdot)}_{-l,j}+C\lambda}\times\frac{n^{(\omega_{{E_{il},c1}})}_{-r,j}+\pi}{n^{(\cdot,E_{il},c1)}_{-r,j}+V\pi}\times\frac{n^{({\omega_{E_{il}},c2})}_{-q,j}+\delta}{n^{(\cdot,E_{il},c2)}_{-q,j}+V\delta}\right)}\quad(2)$$其中<i>i</i>为一个紧固件样本的索引，<i>j</i>为紧固件分类（话题）标签。\(z^d_i\)为图像<i>d</i>中第<i>i</i>个补丁的分类标签，\(z^d_{-i}\)为所有图像补丁的分类标签，不包括图像<i>d</i>的第<i>i</i>个补丁。\(n^{(d)}_{-i,j}\)为分配到图像<i>d</i>中的分类<i>j</i>的三元组的数量，不包括当前的，\(n^{(d)}_{-i}\)是图像<i>d</i>中三元组的全部数量，不包括当前，\(n^{E_{il}}_{-l,j}\)为分配给分类<i>j</i>的坐标对\(E_{il}\)的实例数量，不包括当前，\(n^{(\omega_{E_{il}},c*)}_{-r,j}\)为分类<i>j</i>中出现在坐标\(C^{(*)}_{E_{nl}}\)的单词\(\omega_{C^{(*)}_{E_{nl}}}\)的实例数量，不包括当前单词（*代表1或2），\(n^{(\cdot,E{kl},c*)}_{-r,j}\)为分类<i>j</i>中出现在坐标\(C^{(*)}_{E_{nl}}\)的所有单词的数量，不包括当然单词（*代表1或2）。\(\bf w\)代表被观察单词\(\bf e\)代表坐标列表。常量按如下定义：<i>C</i>为全部坐标对的数量，<i>V</i>为所有视觉单词的数量，<i>P</i>为一个紧固件分类中考虑到的坐标对的数量，<i>K</i>为所有分类（话题）的数量。</p>
	<p>采样算法运行（2）式来多次迭代，每次迭代中更新每个样本的分类（话题）。最后分类标签和一些统计变量被记录下来。这里，类单词和类坐标分布可由下式计算：$$\eta_{j,E,\omega}=\frac{n^{(\omega,E,c1)}_{j}+\pi}{n^{(\cdot,E,c1)}_{j}+V\pi}\quad(3)$$ $$\delta_{j,E,\omega}=\frac{n^{(\omega,E,c2)}_{j}+\rho}{n^{(\cdot,E,c2)}_{j}+V\rho}\quad(4)$$ $$\gamma_{j,E}=\frac{n^{(E)}_{j}+\lambda}{n^{(\cdot)}_{j}+}C\lambda\quad(5)$$其中\(n^{(\omega,E,c*)}_{j}\)为分类<i>j</i>中出现在坐标\(C^{(*)}_{E_{nl}}\)的单词\(\omega\)的实例数量（*代表1或2），\(n^{(\cdot,E,c*)}_{j}\)为分类<i>j</i>中出现在坐标\(C^{(*)}_{E_{nl}}\)的所有单词的数据（*代表1或2），\(n^{(E)}_j\)为分配给分类<i>j</i>的坐标对<i>E</i>的实例数量，\(n^{(\cdot)}_j\)为分配给分类<i>j</i>的所有坐标对的数量。</p>
	<p>给出一个未知紧固件图像及其单词映射\(\bf w\)，分类<i>j</i>的似然可用下式计算：$$p(\mathbf{w},\mathbf{e}|z=j)\propto\sum^C_{E=1}\gamma_{j,E}\cdot\eta_{i,E,\omega}\cdot\delta_{j,E,\omega}\quad(6)$$</p>
	<p>紧固件的分类定义为拥有最大似然的那个$$z=\max_{j=1\cdots K}(p(\mathbf{w},\mathbf{e}|z=j))\quad(7)$$</p>
	<h3><i>C．规范化Haar-Like特征</i></h3>
	<p>Haar-Like特征［24］简单而有效的表示本地结构的方法。在我们的实现中，我们使用5个布局方式，如图<a href="javascript:;" name="fig">Fig．10</a>所示。为了表现出多尺度的结构，我们把五种不同类型的Haar-Like特征与2-10像素的大小链接进45维描述符中。</p>
	<p>多尺度Haar-Like特征被根据每个维度的最大值进行规范化，例如，图<a href="javascript:;" name="fig">Fig．10</a>中的第二个布局可用下式计算出：$$\left|\sum^{H-1}_{j=0}\sum^{2W-1}_{i=W}I(i,j)-\sum^{H-1}_{j=0}\sum^{W-1}_{i=0}I(i,j)\right|\left/\sum^{H-1}_{j=0}\sum^{W-1}_{i=0}{255}\right.\quad(8)$$其中<i>W</i>和<i>H</i>为一个子矩形的宽和高，\(I(i,j)\)为坐标\((i,j)\)处的强度值，其他维度以相同方法规范化处理。</p>
	<h3><i>D．实现细节</i></h3>
	<p>
		<i>1）训练样本：</i>
		使用紧固件定位方法可容易地选择训练样本，该方法在第三部分已介绍过。检测到的铁轨和轨枕的交叉部分的左边和右边区域被捕获为训练样本，样本大小为84×110像素，两边所有类型的紧固件可去标签一起训练。在我们的实验中，训练集有三类紧固件，每种类包含200个样例。
		<div style="border-top: 3px solid; border-bottom: 1px solid;">
			<div style="border-bottom: 1px solid;"><b>算法 1</b> STM的训练过程</div>
			<div><b>初始化：</b></div>
			<div>随机给每个样本\(z^d_i=j_0\)分配话题。</div>
			<div><b>在第m次迭代：</b></div>
			<div>对于第<i>d</i>个图像的第<i>i</i>个样本：</div>
			<div>
				<ol>
					<li>移除话题\(z^d_i=j_m-1\)，</li>
					<li>对每个话题\(j(j=1,\dots,K)\)，用(2)式计算预测的似然值\(p(z^d_i=j|z^d_{-1},\mathbf{w},\mathbf{e})\)；</li>
					<li>对分配自预测的似然值的新话题采样；</li>
					<li>分配新话题\(j_m\)到当前补丁，使\(z^d_i=j_m\)。</li>
				</ol>
			</div>
			<div>对紧固件模型计算等式(3)，(4)，(5)。</div>
		</div>
	</p>
	<p>
		<i>2）参数选取：</i>
		提议的模型中，需要提供STM超参数和话题数量。STM超参数控制多项分布［25］的平滑度，参数由实验进行选取。首先使用推荐参数值［23］，［25］训练模型，然后根据话题分配结果调节参数。我们选取了错误分类最低的参数，在我们的实现下，\(\alpha\)被设置为0.1，其他超参数被设置为1。话题数量<i>K</i>应该比考虑的紧固件类型的实际数量大，以备有足够的话题来表示外观差异。我们的应用中，使用了30个话题来对三种类型的紧固件建模。
	</p>
	<p>
		<i>3）坐标列表生成：</i>
		为减轻计算负担，\(E_{nl}\)所示的坐标是从一个列表选取的。实际上，\(E_{nl}\)是列表中一个元素的索引。坐标列表生成如下，对每种类型的紧固件，我们用不同的灰度绘制一个素描，如图<a href="javascript:;" name="fig">Fig．11</a>所示。然后，算法随机选择若干不同灰度的像素组，且记录下两个坐标的组对，成为一个坐标列表。要说明的是，来自不同素描的组对都一起被混合，我们的配置是坐标列表中包含11451个组对。
	</p>
	<p>
		<i>4）训练过程：</i>
		通过在提取自训练样本的所有Haar特征上执行K均值集群，会首先构建一个视觉字典，每个集群中心识作一个视觉单词。我们的实现下，字典中总共有200个视觉单词。另外，一些视觉单词对应平坦特征（特征值非常低），是无意义的，这些单词需要人工进一步识别和移除。然后，根据最近邻准则，一个图像中的每个特征描述符被映射到一个确定的视觉单词，由此，每个图像可被一系列视觉单词所代表。
	</p>
	<p>训练过程总结在了算法 1中。需要说明的是，要计算\(n^{E_{il}}_{-l,j}\)和\(n^{(\cdot)}_{-l,j}\)，一对坐标出现的条件被定义为在坐标\(C^{(1)}_{E_{nl}}\)和\(C^{(2)}_{E_{nl}}\)处的视觉单词都不是无意义的。</p>
	<p>
		<i>5）紧固件分类：</i>
		对于每个测试样例，Haar-Like特征是第一个提取和映射到视觉字典的。然后，我们以逐像素的方式扫描其单词映射，并对每个话题使用式(6)计算似然概率。扫描完全部图像后，一组概率映射即完成。一个紧固件的类型可用(7)式计算概率映射的最大值来确定。
	</p>
	<h2>V．实验结果</h2>
	<p>这部分内容会对紧固件检测方法和STM紧固件模型进行评估，测试集包含57124个图像涵盖了110Km铁路线，每个图像有六个或8个紧固件，总共有399078个紧固件。</p>
	<h3><i>A．紧固件定位</i></h3>
	<p>在实验中，我们用两套方案来定位紧固件。第一，在所有图像上执行轨枕和轨道检测算法，第二，使用轨枕预测方法并定期调整<i>Dy</i>。图<a href="javascript:;" name="fig">Fig．12</a>所示轨枕和轨道检测结果的示例，其中被水平线包围的区域为检测到的轨枕，竖直线为检测到的轨道边缘。</p>
	<p>评估结果如<a href="javascript:;">表格 I</a>所示，从表格中可以看到紧固件检测算法达到了95.2%的检测率，轨枕预测法使得检测率提升到了100%。显然伴随有铁路配置的先知性，紧固件检测算法达到了非常可靠的表现。</p>
	<p style="text-align: center">
		<b>表格 I</b>
		<br>
		提出的紧固件检测算法的检测率
		<table frame="box" rules="all" cellspacing="0" cellpadding="16" align="center">
			<tr>
				<th></th><th>使用轨枕检测</th><th>使用轨枕预测</th>
			</tr>
			<tr>
				<td>检测率</td><td>95.2%</td><td>100%</td>
			</tr>
		</table>
	</p>
	<h3><i>B．紧固件分类和分值排名</i></h3>
	<p>在实验中，我们对图<a href="javascript:;" name="fig">Fig．1</a>中三个广泛使用的紧固件进行建模。训练集包含600幅图像，尺寸为84×110像素，实验细节在IV-D部分介绍过了。模型按如下配置：1）狄利克雷分布的超参数为\(\alpha=0.1\)，\(\pi=1\)，\(\lambda=1\)，\(\rho=1\);2）话题数<i>K</i>为30；3）迭代次数为100。参数的设置影响着训练速度，在当前配置下，我们的电脑进行训练阶段花费了2小时，最大消耗内存7.2GB。</p>
	<p>下面的部分中，首先是训练样本的话题分配，然后，通过对紧固件分类，所提方法的有效性将得以验证，最后，将会对测试紧固件的结果排名进行讲解。</p>
	<p>
		<i>1）话题分配结果：</i>
		STM训练的过程根据样本的结构配置及每个能被同时获取的模型来将样本集群到话题中。图<a href="javascript:;" name="fig">Fig．13</a>中显示了11个话题的分配结果，由于空间较少，每个话题只给出了4个样本。显然每个话题代表方向和光照条件相同的一类紧固件，每个话题的标签由人工提供。
	</p>
	<p>
		<i>2）紧固件分类：</i>
		这部分是测试样本的分类结果。测试集是不同类型紧固件的混合，有几个损坏的，还有几个缺失的。测试图像通过了紧固件检测算法，且大小为100×160像素。如我们在IV-D部分介绍的，在测试图像上，扫描着一个84×110像素的子窗口来计算每个紧固件模型（话题）的似然值。这些概率可在规范化后显示出，如图<a href="javascript:;" name="fig">Fig．14</a>所示。然后，测试样本的分类（话题）由所有映射之间的最大似然确定。这里的情况下，紧固件被分类到话题 6。
	</p>
	<p>紧固件分类的表现由recall和precision［26］，［27］评估。Recall和precision是广泛用于评估分类和检测算法的标准，其定义为$$\rm{Recall}=\mit\frac{tp}{N}\quad\rm(9)$$ $$\rm{Presicion}=\mit\frac{tp}{tp+fp}\quad\rm(10)$$其中\(tp\)为对一个类已正确分类的样本的数量，\(fp\)为非期望分类到类中的样本，而<i>N</i>为该类的所有测试样本的数量。换句话说，recall指的是正确分类的实例的百分比，precision为对一个类分类的准确度。评估结果如<a href="javascript:;">表格 II</a>所示。应该要说的是，相同类型的紧固件是算在一起的.从表格中可以看到所有类型有相当高的precision和recall。</p>
	<p style="text-align: center">
		<b>表格 II</b>
		<br>
		用STM的紧固件分类的结果评估
		<table frame="box" rules="all" cellspacing="0" cellpadding="16" align="center">
			<tr>
				<th>类型</th><th>Recall</th><th>Precision</th>
			</tr>
			<tr>
				<td>类型-I 左</td><td>99.6%</td><td>99.9%</td>
			</tr>
			<tr>
				<td>类型-I 右</td><td>99.7%</td><td>99.9%</td>
			</tr>
			<tr>
				<td>类型-II 左</td><td>99.4%</td><td>99.9%</td>
			</tr>
			<tr>
				<td>类型-II 右</td><td>99.3%</td><td>99.3%</td>
			</tr>
			<tr>
				<td>类型-III 左</td><td>97.3%</td><td>97.9%</td>
			</tr>
			<tr>
				<td>类型-III 右</td><td>97.4%</td><td>96.5%</td>
			</tr>
		</table>
	</p>
	<p>我们对部分损坏和缺失的紧固件的分类结果进行评估，部分损坏的紧固件有些缺损和模糊的部分，到那是视觉识别到的。另一方面，缺失的紧固件失去了其主要部件，比如钩子，他们是不可识别的，且大部分表现为平坦的图像区域。如图<a href="javascript:;" name="fig">Fig．2</a>中的两种情况。所有磨损的紧固件样本被选取来测试，有3312个部分损坏的和746个缺失的紧固件。我们的方法对部分损坏的紧固件达到了99.5%的分类准确度。图<a href="javascript:;" name="fig">Fig．15</a>(a)显示了分类错误的样本，可以看到样本被石头和线缆覆盖了。另一方面，缺失紧固件的分类无法确定,平均分类准确度只有21.3%。图<a href="javascript:;" name="fig">Fig．15</a>(b)展示了一些缺失紧固件的例子。应当要说的是，缺失紧固件的误分类不会影响磨损分级（见IV-D部分图<a href="javascript:;" name="fig">Fig．16</a>），因为这些紧固件匹配不到任何模型。但是，如有必要，可以修正错误分类。一般情况下，安装在同一个轨枕上的紧固件是同类型的。因此，错误分类的样本可很容易识别到并改正。</p>
	<p>为了做出比较，像提高树［6］，隐SVM［28］，自己神经网络［7］等分类器都被训练和测试在相同数据集上。在该实验中，分类器考虑7个分类，对应于带有两个方向的三种类型紧固件和一个非紧固件类,其他样本作测试用。我们用HOG描述符［28］和Gabor小波［29］来提取紧固件的结构信息。所有准确度如<a href="javascript:;">表格 III</a>所示。与STM比较，其他方法达到的准确度较低。出现此结果的原因有两个：1）训练模型的光照变化对分类器的表现影响较大，2）一些紧固件的形状相似，分类器和特征无法有效区分出。对于STM，分类数量根据训练样本自动确定,最终不同光照条件的紧固件被单独建模。另一方面，在紧固件形状上STM有严格的空间约束，因此模型能识别出相似形状间的不同。可以看出，所提方法能够在不同视觉条件下对多种类型的紧固件进行建模。</p>
	<p style="text-align: center">
		<b>表格 III</b>
		<br>
		STM，提高树，隐SVM，神经网络分类器的准确度
		<table frame="box" rules="all" cellspacing="0" cellpadding="16" align="center">
			<tr>
				<th>方法<br>（特征）</th><th>STM<br>（Haar-Like）</th><th>提高树<br>（HOG）</th><th>隐SVM<br>（HOG）</th><th>神经网络<br>Gabor小波</th>
			</tr>
			<tr>
				<td>准确度</td><td>98.9%</td><td>93.4%</td><td>94.4%</td><td>92.5%</td>
			</tr>
		</table>
	</p>
	<p>
		<i>3）磨损分级</i>
		为识别出损坏的紧固件，则需要规范化并分级样本的似然。似然可理解为一个分值，能够测出紧固件和模型间的一致性。分值越低，紧固件质量就越差。正如以上介绍的，似然被分组并分为三级，中级和低级是需要留意的。在低级别中，紧固件与模型有明显差异，这些大多数对应着缺失的紧固件。中级别的紧固件是部分损坏，污染或被污物覆盖的。我们建议由人工检测员对这些紧固件进行更细致的检查，以确定其确切的状态。每个等级的分值范围定义如下，高级别范围在0.5-1.0，即有超过一半的紧固件会匹配到此模型，中级别分值范围为0.1-0.5，即此范围仅能识别到一小部分紧固件，最后，低级别范围为0-0.1。
	</p>
	<p>图<a href="javascript:;" name="fig">Fig．16</a>展示了一些分级结果的例子。由于空间较少，我们只展示了左侧紧固件的结果，图片下方给出了规范化的分值。我们也提供了人工检测结果（地面实测），结果代表完整度百分比。在这399 078个样本中，有392 518(98.4%)个紧固件分级为高级，我们也确认了这些紧固件都属良好。再来，有5726(1.4%)个样本分级为中级，这些紧固件有4种主要情况：1）部分损坏的，2）部分被遮盖的，3）污染的，4）好的。需要说明的是，被遮盖的紧固件真实条件未知，所以认为其是损坏的。除此之外，也有大量好的紧固件（2502个）分进了中级，这或许是形状和光照条件存在严重的变化。最后，834个(0.2%)紧固件被分到低级中，这些都是严重损坏了的。正如上面提到的，缺失的紧固件总是被误分类，因为没有可用信息，这个问题不影响分级结果，因为这些紧固件不匹配任何模型，且其似然概率也很低，结果是，这些缺失的紧固件都被识别为低级。</p>
	<p>与判别模型比较，我们的方法提供了一个混淆类（中级别），我们相信在应用中混淆类是有作用的。中级别紧固件处于边界条件，且在传统判别模型中很可能误分类，结果是，一些铁路公司任然需要人工检测员定期复检所有的紧固件图像。我们的方法中，紧固件的情况可以定量评估出，还会搜集到处在边界条件的紧固件，因此检测员可以专心处理这些较难确定的情况。另一方面，每两个级别之间的阈值是灵活的，可根据统计标准或由分类器学到的进行调整。</p>
	<p>为证明我们方法的有效性，我们将磨损分级看作一个分类问题，并与一些最先进的方法比较其全准确度，为计算出准确度，中级损坏的和低级的紧固件会看作是正确分类的。而且，我们也在每个类（话题）的规范化似然值上训练了SVM线性分类器。我们选取了1000个样本来训练基于分类器的方法（500个完好的，500个损坏的），其余的则用于评估。因为其他方法只能处理单一类型的紧固件，此测试在类型-i左侧样本上来进行，全部准确度列出在了表格 IV中。从表格中可以看到我们的方法比其他方法要好，有两个原因：1）其他方法无法识别部分损坏的紧固件，2）其他方法很难应对严重变化的光照条件。</p>
	<p>应该要说的是，测试样本含有持续明亮变化的紧固件。我们选取了677个受阳光影响的样本来评估我们的方法的表现，在图<a href="javascript:;" name="fig">Fig．17</a>中，展示了话题分配结果和一系列在不同光照角度下拍摄的紧固件的分级结果。可以看到多数紧固件分配到了话题 2，对应亮度非常高的紧固件，对于这些样本，分级准确度为100%。此外，暗色的紧固件可匹配到其他话题，对应其亮度等级。我们相信我们的方法能有效识别光照条件变化的紧固件，对此有两个主要原因。第一，STM使用多个模型来表示不同外观的紧固件，第二，特征袋允许一个单词来表示一个范围的特征值，然后不同亮度的图像就能对应相同的单词分配。</p>
	<h3><i>C．速度</i></h3>
	<p>使用并行计算技术如多核处理器和分式式系统可以容易的提高我们的方法的速度。在我们的实现中，图像分布在不同的计算机（处理器核心）中来并行运行紧固件分类算法（STM推演）。我们的系统中有四台计算机，主计算机安装了一个Intel Core-i7-3770K处理器（四核八线程），负责图像获取，任务调度及分级。其他则是2U blade工作站，每台配置八个Intel Xeon L5520处理器（32核64线程），用于进行紧固件分类。</p>
	<p>首先，主计算机获取图像并保存到数据库，一旦有了1200幅图像，这些图像就会通过LAN分配到一台工作站。对每台工作站来说，首先执行紧固件检测算法，然后把紧固件图像顺序分配给不同的核心，以根据训练的STM计算似然概率。类标签和似然概率最后返回到主计算机，当前系统配置如图<a href="javascript:;" name="fig">Fig．18</a>所示。单台计算机的紧固件定位速度是0.007s每个，分类速度为0.065s每个，我们系统的平均检测速度为262.3km/h。应当要说的是，速度是根据第一个和最后一个紧固件分开的全部处理时间来计算的。如果有更多工作站，速度还能够继续提升。</p>
	<h2>VI．结论</h2>
	<p>铁路监测中，损坏及缺失紧固件的检测是一个重要任务。然而人工检测效率低下，早期基于分类器的自动检测系统可靠度也不高。</p>
	<p>本文中，提出了一个能够同时评估多个类型的紧固件的检测系统。依靠话题模型，提出的检测系统有以下三个主要优势：1）使用非标签数据可同时建模不同类型的紧固件，2）系统对光照条件是鲁棒性的，3）紧固件状态分级。技术上我们介绍了一个新的叫做STM的话题模型来对紧固件的结构进行建模，某种可能上讲STM是第一个旨在表示对象结构的概率话题模型，这使得多种类型的紧固件建模更容易了。</p>
	<p>有此铁路线评估的细节，我们提出的方法在识别好的和检测损坏的紧固件上有非常高的性能。</p>
	<h2>感谢</h2>
	<p>作者非常感谢中国铁路科学研究院提供数据。</p>
</body>
</html>
